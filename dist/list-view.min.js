// ==========================================================================
// Project:   Ember ListView
// Copyright: Â©2012-2013 Erik Bryn, Yapp Inc., and contributors.
// License:   Licensed under MIT license
// ==========================================================================


// Last commit: d07b4db (2014-01-09 09:51:32 +0700)


!function(){function t(t,e){return t&&e&&t.x===e.x&&t.y===e.y}function e(){var e,n,r;Ember.instrument("view.updateContext.positionElement",this,function(){e=i(this,"element"),n=i(this,"position"),r=this._position,n&&e&&(t(n,r)||(this._parentView.applyTransform(e,n.x,n.y),this._position=n))},this)}var i=Ember.get;Ember.set,Ember.ListItemViewMixin=Ember.Mixin.create({init:function(){this._super(),this.one("didInsertElement",e)},classNames:["ember-list-item-view"],_position:null,_positionDidChange:Ember.observer(e,"position"),_positionElement:e})}(),function(){function t(t){t.willInsertElement&&t.willInsertElement()}function e(t){t.didInsertElement&&t.didInsertElement()}function i(){var i,o,l,h;i=n(this,"element"),i&&(l=n(this,"context"),this.triggerRecursively("willClearRender"),this.lengthAfterRender>this.lengthBeforeRender&&(this.clearRenderedChildren(),this._childViews.length=this.lengthBeforeRender),l?(o=Ember.RenderBuffer(),o=this.renderToBuffer(o),h=this._childViews.length>0,h&&this.invokeRecursively(t,!1),i.innerHTML=o.innerString?o.innerString():s(o),r(this,"element",i),this.transitionTo("inDOM"),h&&this.invokeRecursively(e,!1)):i.innerHTML="")}var n=Ember.get,r=Ember.set,s=function(t){var e=[],i=t.childBuffers;return Ember.ArrayPolyfills.forEach.call(i,function(t){var i="string"==typeof t;i?e.push(t):t.array(e)}),e.join("")};Ember.ListItemView=Ember.View.extend(Ember.ListItemViewMixin,{updateContext:function(t){var e=n(this,"context");Ember.instrument("view.updateContext.render",this,function(){e!==t&&(this.set("context",t),t instanceof Ember.ObjectController&&this.set("controller",t))},this)},rerender:function(){Ember.run.scheduleOnce("render",this,i)},_contextDidChange:Ember.observer(i,"context","controller")})}(),function(){var t=Ember.get,e=Ember.set;Ember.ReusableListItemView=Ember.View.extend(Ember.ListItemViewMixin,{init:function(){this._super(),this.set("context",Ember.ObjectProxy.create())},isVisible:Ember.computed("context.content",function(){return!!this.get("context.content")}),updateContext:function(i){var n=t(this,"context.content");n!==i&&("inDOM"===this.state&&this.prepareForReuse(i),e(this,"context.content",i))},prepareForReuse:Ember.K})}(),function(){function t(t){if(t in i)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),r=0;r<n.length;r++){var s=n[r]+e;if(s in i)return s}return null}var e=document.createElement("div"),i=e.style,n=["Webkit","Moz","O","ms"],r=t("transform"),s=t("perspective"),o=null!==r,l=null!==s;Ember.ListViewHelper={transformProp:r,applyTransform:function(){return o?function(t,e,i){t.style[r]="translate("+e+"px, "+i+"px)"}:function(t,e,i){t.style.top=i+"px",t.style.left=e+"px"}}(),apply3DTransform:function(){return l?function(t,e,i){t.style[r]="translate3d("+e+"px, "+i+"px, 0)"}:o?function(t,e,i){t.style[r]="translate("+e+"px, "+i+"px)"}:function(t,e,i){t.style.top=i+"px",t.style.left=e+"px"}}()}}(),function(){function t(){var t=o(this,"content");t&&t.addArrayObserver(this)}function e(t){this.removeObject(t),t.destroy()}function i(){Ember.run.once(this,"_syncChildViews")}function n(t,e){return o(t,"contentIndex")-o(e,"contentIndex")}function r(){Ember.View.notifyMutationListeners&&Ember.run.once(Ember.View,"notifyMutationListeners")}function s(){var t,e,i,n,r,s,l;o(this,"isHorizontal")?(r=o(this,"elementHeight"),s=o(this,"rowCount"),l=r*s,n=this.$(".ember-list-container"),l&&n&&n.css("height",l)):(t=o(this,"elementWidth"),e=o(this,"columnCount"),i=t*e,n=this.$(".ember-list-container"),i&&n&&n.css("width",i))}var o=Ember.get,l=Ember.set,h=Math.min,c=Math.max,a=Math.floor,u=Math.ceil,d=Ember.ArrayPolyfills.forEach,m=Ember.create(Ember.ContainerView.proto().domManager);m.prepend=function(t,e){t.$(".ember-list-container").prepend(e),r()},Ember.ListViewMixin=Ember.Mixin.create({itemViewClass:Ember.ListItemView,emptyViewClass:Ember.View,classNames:["ember-list-view"],attributeBindings:["style"],domManager:m,scrollOffset:0,bottomPadding:0,rightPadding:0,_lastEndingIndex:0,paddingCount:1,isHorizontal:!1,totalSize:Ember.computed("isHorizontal","totalWidth","totalHeight",function(){return o(this,"isHorizontal")?o(this,"totalWidth"):o(this,"totalHeight")}),size:Ember.computed("isHorizontal","width","height",function(){return o(this,"isHorizontal")?o(this,"width"):o(this,"height")}),init:function(){this._super(),this.on("didInsertElement",s),this.columnCountDidChange(),this._syncChildViews(),this._addContentArrayObserver()},_addContentArrayObserver:Ember.beforeObserver(function(){t.call(this)},"content"),render:function(t){t.push('<div class="ember-list-container">'),this._super(t),t.push("</div>")},willInsertElement:function(){if(this.get("isHorizontal")){if(!this.get("width")||!this.get("columnWidth"))throw new Error("An horizontal ListView must be created with a width and a columnWidth.")}else if(!this.get("height")||!this.get("rowHeight"))throw new Error("A vertical ListView must be created with a height and a rowHeight.");this._super()},style:Ember.computed("height","width",function(){var t,e,i,n;t=o(this,"height"),e=o(this,"width"),n=o(this,"css"),i="",t&&(i+="height:"+t+"px;"),e&&(i+="width:"+e+"px;");for(var r in n)n.hasOwnProperty(r)&&(i+=r+":"+n[r]+";");return i}),scrollTo:function(){throw new Error("must override to perform the visual scroll and effectively delegate to _scrollContentTo")},_scrollTo:Ember.K,_scrollContentTo:function(t){var e,i,n,r,s,a;a=c(0,t),o(this,"scrollOffset")!==a&&(a=Math.min(a,o(this,"totalSize")-o(this,"size")),Ember.instrument("view._scrollContentTo",{scrollOffset:a,content:o(this,"content"),startingIndex:this._startingIndex(),endingIndex:h(c(o(this,"content.length")-1,0),this._startingIndex()+this._numChildViewsForViewport())},function(){s=o(this,"content.length"),l(this,"scrollOffset",a),r=c(s-1,0),e=this._startingIndex(),n=e+this._numChildViewsForViewport(),i=h(r,n),this.trigger("scrollOffsetChanged",t),(e!==this._lastStartingIndex||i!==this._lastEndingIndex)&&(this._reuseChildren(),this._lastStartingIndex=e,this._lastEndingIndex=i)},this))},totalHeight:Ember.computed("content.length","rowHeight","columnCount","bottomPadding","isHorizontal",function(){var t,e,i,n;return o(this,"isHorizontal")?o(this,"height"):(t=o(this,"content.length"),e=o(this,"rowHeight"),i=o(this,"columnCount"),n=o(this,"bottomPadding"),u(t/i)*e+n)}),totalWidth:Ember.computed("content.length","columnWidth","rowCount","rightPadding","isHorizontal",function(){var t,e,i,n;return o(this,"isHorizontal")?(t=o(this,"content.length"),e=o(this,"columnWidth"),i=o(this,"rowCount"),n=o(this,"rightPadding"),u(t/i)*e+n):o(this,"width")}),_prepareChildForReuse:function(t){t.prepareForReuse()},_reuseChildForContentIndex:function(t,e){var i,n,r,s;i=o(this,"content"),s=o(this,"enableProfiling"),r=this.positionForIndex(e),l(t,"position",r),l(t,"contentIndex",e),s&&Ember.instrument("view._reuseChildForContentIndex",r,function(){},this),n=i.objectAt(e),t.updateContext(n)},positionForIndex:function(t){var e,i,n,r,s,l,h,c;return o(this,"isHorizontal")?(l=o(this,"elementHeight")||1,h=o(this,"rowCount"),c=o(this,"columnWidth"),s=c*a(t/h),r=t%h*l,{y:r,x:s}):(e=o(this,"elementWidth")||1,i=o(this,"columnCount"),n=o(this,"rowHeight"),r=n*a(t/i),s=t%i*e,{y:r,x:s})},_childViewCount:function(){var t,e;return t=o(this,"content.length"),e=this._numChildViewsForViewport(),h(t,e)},columnCount:Ember.computed("width","elementWidth",function(){var t,e,i;return t=o(this,"elementWidth"),e=o(this,"width"),i=t?a(e/t):1}),columnCountDidChange:Ember.observer(function(){var t,e,i,n,r,c,a;o(this,"isHorizontal")||(c=this._lastColumnCount,e=o(this,"scrollOffset"),a=o(this,"columnCount"),n=o(this,"maxScrollTop"),this._lastColumnCount=a,c&&(t=c/a,i=e*t,r=h(n,i),this._scrollTo(r),l(this,"scrollOffset",r)),arguments.length>0&&Ember.run.schedule("afterRender",this,s))},"columnCount"),maxScrollTop:Ember.computed("height","totalHeight",function(){var t,e;return t=o(this,"totalHeight"),e=o(this,"height"),c(0,t-e)}),rowCount:Ember.computed("height","elementHeight",function(){var t,e,i;return t=o(this,"elementHeight"),e=o(this,"height"),i=t?a(e/t):1}),rowCountDidChange:Ember.observer(function(){var t,e,i,n,r,c,a;o(this,"isHorizontal")&&(c=this._lastRowCount,e=o(this,"scrollOffset"),a=o(this,"rowCount"),n=o(this,"maxScrollLeft"),this._lastRowCount=a,c&&(t=c/a,i=e*t,r=h(n,i),this._scrollTo(r),l(this,"scrollOffset",r)),arguments.length>0&&Ember.run.schedule("afterRender",this,s))},"rowCount"),maxScrollLeft:Ember.computed("width","totalWidth",function(){var t,e;return t=o(this,"totalWidth"),e=o(this,"width"),c(0,t-e)}),_numChildViewsForViewport:function(){var t,e,i,n,r,s,l;return o(this,"isHorizontal")?(r=o(this,"width"),s=o(this,"columnWidth"),i=o(this,"paddingCount"),l=o(this,"rowCount"),u(r/s)*l+i*l):(t=o(this,"height"),e=o(this,"rowHeight"),i=o(this,"paddingCount"),n=o(this,"columnCount"),u(t/e)*n+i*n)},_startingIndex:function(){var t,e,i,n,r,s,l,u;return r=o(this,"content.length"),t=o(this,"scrollOffset"),o(this,"isHorizontal")?(l=o(this,"columnWidth"),u=o(this,"rowCount"),n=a(t/l)*u,s=c(r-1,0),h(n,s)):(e=o(this,"rowHeight"),i=o(this,"columnCount"),n=a(t/e)*i,s=c(r-1,0),h(n,s))},contentWillChange:Ember.beforeObserver(function(){var t;t=o(this,"content"),t&&t.removeArrayObserver(this)},"content"),contentDidChange:Ember.observer(function(){t.call(this),i.call(this)},"content"),needsSyncChildViews:Ember.observer(i,"height","width","columnCount","rowCount","isHorizontal"),_addItemView:function(){var t,e;t=o(this,"itemViewClass"),e=this.createChildView(t),this.pushObject(e)},_syncChildViews:function(){var t,i,n,r,s,l,h,c;if(!o(this,"isDestroyed")&&!o(this,"isDestroying")){if(i=this._childViewCount(),s=this.positionOrderedChildViews(),t=this._startingIndex(),r=i,n=s.length,h=r-n,0===h);else if(h>0)for(c=this._lastEndingIndex,l=0;h>l;l++,c++)this._addItemView(c);else d.call(s.splice(r,n),e,this);this._reuseChildren(),this._lastStartingIndex=t,this._lastEndingIndex=this._lastEndingIndex+h}},_reuseChildren:function(){var t,e,i,n,r,s,o;for(t=this.getReusableChildViews(),e=t.length,i=this._startingIndex(),s=i+this._numChildViewsForViewport(),o=h(s,i+e),r=i;o>r;r++)n=t[r%e],this._reuseChildForContentIndex(n,r)},getReusableChildViews:function(){return this._childViews},positionOrderedChildViews:function(){return this.getReusableChildViews().sort(n)},arrayWillChange:Ember.K,arrayDidChange:function(t,e){var n,r;"inDOM"===this.state&&((e>=this._lastStartingIndex||e<this._lastEndingIndex)&&(n=0,d.call(this.positionOrderedChildViews(),function(t){r=this._lastStartingIndex+n,this._reuseChildForContentIndex(t,r),n++},this)),i.call(this))}})}(),function(){var t=Ember.get;Ember.set,Ember.ListView=Ember.ContainerView.extend(Ember.ListViewMixin,{css:{position:"relative",overflow:"scroll","-webkit-overflow-scrolling":"touch","overflow-scrolling":"touch"},applyTransform:Ember.ListViewHelper.applyTransform,_scrollTo:function(e){var i=t(this,"element");i&&(i[t(this,"isHorizontal")?"scrollLeft":"scrollTop"]=e)},didInsertElement:function(){var e,i;e=this,i=t(this,"element"),this._updateScrollableSize(),this._scroll=function(t){e.scroll(t)},Ember.$(i).on("scroll",this._scroll)},willDestroyElement:function(){var e;e=t(this,"element"),Ember.$(e).off("scroll",this._scroll)},scroll:function(e){Ember.run(this,this.scrollTo,e.target[t(this,"isHorizontal")?"scrollLeft":"scrollTop"])},scrollTo:function(t){this._scrollTo(t),this._scrollContentTo(t)},totalSizeDidChange:Ember.observer(function(){Ember.run.scheduleOnce("afterRender",this,this._updateScrollableSize)},"totalSize"),_updateScrollableSize:function(){var e="",i="";"inDOM"===this.state&&(t(this,"isHorizontal")?i=t(this,"totalSize"):e=t(this,"totalSize"),this.$(".ember-list-container").css({height:e,width:i}))}})}(),function(){function t(t){this.mouseWheel(t),t.preventDefault()}function e(t,e){t.addEventListener(u,e.start,!1),t.addEventListener("mousewheel",e.wheel,!1)}function i(t,e){t.removeEventListener(u,e.start,!1),t.removeEventListener("mousewheel",e.wheel,!1)}function n(t){window.addEventListener(d,t.move,!0),window.addEventListener(m,t.end,!0),window.addEventListener(f,t.cancel,!0)}function r(t){window.removeEventListener(d,t.move,!0),window.removeEventListener(m,t.end,!0),window.removeEventListener(f,t.cancel,!0)}function s(t,e){return function(i){e.call(t,i)}}function o(t){var e,i=t.changedTouches[0],n=i.target;return n&&g.test(n.tagName)?(e=document.createEvent("MouseEvents"),e.initMouseEvent("click",!0,!0,t.view,1,i.screenX,i.screenY,i.clientX,i.clientY,t.ctrlKey,t.altKey,t.shiftKey,t.metaKey,0,null),n.dispatchEvent(e)):void 0}var l,h,c,a,u,d,m,f,g=/input|textarea|select/i,w="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch;w?(u="touchstart",l=function(t){var e=t.touches[0],i=e&&e.target;i&&g.test(i.tagName)||(n(this.scrollerEventHandlers),this.willBeginScroll(t.touches,t.timeStamp),t.preventDefault())},d="touchmove",h=function(t){this.continueScroll(t.touches,t.timeStamp)},m="touchend",c=function(t){this._isScrolling||o(t),r(this.scrollerEventHandlers),this.endScroll(t.timeStamp)},f="touchcancel",a=function(t){r(this.scrollerEventHandlers),this.endScroll(t.timeStamp)}):(u="mousedown",l=function(t){if(1===t.which){var e=t.target;e&&g.test(e.tagName)||(n(this.scrollerEventHandlers),this.willBeginScroll([t],t.timeStamp),t.preventDefault())}},d="mousemove",h=function(t){this.continueScroll([t],t.timeStamp)},m="mouseup",c=function(t){r(this.scrollerEventHandlers),this.endScroll(t.timeStamp)},f="mouseout",a=function(t){t.relatedTarget||(r(this.scrollerEventHandlers),this.endScroll(t.timeStamp))}),Ember.VirtualListScrollerEvents=Ember.Mixin.create({init:function(){return this.on("didInsertElement",this,"bindScrollerEvents"),this.on("willDestroyElement",this,"unbindScrollerEvents"),this.scrollerEventHandlers={start:s(this,l),move:s(this,h),end:s(this,c),cancel:s(this,a),wheel:s(this,t)},this._super()},bindScrollerEvents:function(){var t=this.get("element"),i=this.scrollerEventHandlers;e(t,i)},unbindScrollerEvents:function(){var t=this.get("element"),e=this.scrollerEventHandlers;i(t,e),r(e)}})}(),function(){function t(t){var i,n,r,s,o;t=t||this,o=e(t,"isHorizontal"),i=e(t,"width"),n=e(t,"height"),r=o?n:e(t,"totalHeight"),s=o?e(t,"totalWidth"):i,t.scroller.setDimensions(i,n,s,r),t.trigger("scrollerDimensionsDidChange")}var e=(Math.max,Ember.get);Ember.set,Ember.VirtualListView=Ember.ContainerView.extend(Ember.ListViewMixin,Ember.VirtualListScrollerEvents,{_isScrolling:!1,_mouseWheel:null,css:{position:"relative",overflow:"hidden"},init:function(){this._super(),this.setupScroller(),this.setupPullToRefresh()},_scrollerOffset:0,applyTransform:Ember.ListViewHelper.apply3DTransform,setupScroller:function(){var e,i;e=this,i=this.get("isHorizontal"),e.scroller=new Scroller(function(t,n){"inDOM"===e.state&&e.listContainerElement&&(i?(e.applyTransform(e.listContainerElement,-t,0),e._scrollerOffset=t):(e.applyTransform(e.listContainerElement,0,-n),e._scrollerOffset=n),e._scrollContentTo(e._scrollerOffset))},{scrollingY:!i,scrollingX:i,scrollingComplete:function(){e.trigger("scrollingDidComplete")}}),e.trigger("didInitializeScroller"),t(e)},setupPullToRefresh:function(){this.pullToRefreshViewClass&&(this._insertPullToRefreshView(),this._activateScrollerPullToRefresh())},_insertPullToRefreshView:function(){this.pullToRefreshView=this.createChildView(this.pullToRefreshViewClass),this.insertAt(0,this.pullToRefreshView);var t,e=this,i=e.get("isHorizontal");this.pullToRefreshView.on("didInsertElement",function(){t=-1*e.pullToRefreshViewSize,e.applyTransform(this.get("element"),i?t:0,i?0:t)})},_activateScrollerPullToRefresh:function(){function t(){n.pullToRefreshView.set("active",!0),n.trigger("activatePullToRefresh")}function e(){n.pullToRefreshView.set("active",!1),n.trigger("deactivatePullToRefresh")}function i(){function t(){!n||n.get("isDestroyed")||n.get("isDestroying")||(n.scroller.finishPullToRefresh(),n.pullToRefreshView.set("refreshing",!1))}n.pullToRefreshView.set("refreshing",!0),n.startRefresh(t)}var n=this;this.scroller.activatePullToRefresh(this.pullToRefreshViewSize,t,e,i)},getReusableChildViews:function(){var t=this._childViews[0];return t&&t===this.pullToRefreshView?this._childViews.slice(1):this._childViews},scrollerDimensionsNeedToChange:Ember.observer(function(){Ember.run.once(this,t)},"width","height","totalHeight","totalWidth","isHorizontal"),didInsertElement:function(){this.listContainerElement=this.$("> .ember-list-container")[0]},willBeginScroll:function(t,e){this._isScrolling=!1,this.trigger("scrollingDidStart"),this.scroller.doTouchStart(t,e)},continueScroll:function(t,e){var i,n,r;this._isScrolling?this.scroller.doTouchMove(t,e):(i=this._scrollerOffset,this.scroller.doTouchMove(t,e),n=this._scrollerOffset,i!==n&&(r=Ember.$.Event("scrollerstart"),Ember.$(t[0].target).trigger(r),this._isScrolling=!0))},endScroll:function(t){this.scroller.doTouchEnd(t)},scrollTo:function(t,i){var n=e(this,"isHorizontal");void 0===i&&(i=!0),this.scroller.scrollTo(n?t:0,n?0:t,i,1)},mouseWheel:function(t){var i,n,r,s=e(this,"isHorizontal");return i=t.webkitDirectionInvertedFromDevice,n=t[s?"wheelDeltaX":"wheelDeltaY"]*(i?.8:-.8),r=this.scroller[s?"__scrollLeft":"__scrollTop"]+n,r>=0&&r<=this.scroller[s?"__maxScrollLeft":"__maxScrollTop"]&&this.scroller.scrollBy(s?n:0,s?0:n,!0),!1}})}(),"undefined"==typeof location||"localhost"!==location.hostname&&"127.0.0.1"!==location.hostname||Ember.Logger.warn("You are running a production build of Ember on localhost and won't receive detailed error messages. If you want full error messages please use the non-minified build provided on the Ember website.");